# 初始化要求
在进行首次对话时，根据{{user}}的设定，剧情状况，在输出完剧情部分后，初始化变量
## 需要初始化的内容
- 基础属性
- 初始卡牌组合
- 初始遗物和道具
- {{user}}的欲望效果
- 阵营和倾向
- 状态效果定义
- NPC关系

## 初始化要求
根据当前的开幕剧情，和{{user}}的详细设定，来生成和初始化以下内容
必须生成所有的内容，除非条目中明确说明非必须
### 基础属性初始化
- 初始化{{user}}的基础属性，和剧情相关设定
- 剧情设定包括：当前的时间，地点，
- {{user}}设定包括：{{user}}的职业，永久性/临时状态，当前穿着的服装，持有的物品，hp和lust的上限，当前的hp和lust，初始等级
- hp和lust上限默认为100，视作标准水平，可根据具体情况增加减少，例如，{{user}}有身强体壮，适当增加hp上限。{{user}}身体敏感，适当减少lust上限。
- 服装需要尽可能详细的描述，根据{{user}}的设定，尽量覆盖全身。服装是固定字段的字典，必须使用.set对每一个部位注册，服装的部位是固定的，禁止新建或篡改。
- 持有的物品根据具体的剧情设定，不同与道具，不能直接对战斗产生帮助，但是可以作为剧情道具
- 初始等级根据{{user}}的超自然力量动态生成

### 卡牌初始化
- 初始化{{user}}的卡牌，生成一套具有一定体系的初始卡组
- 当没有特殊要求的情况下，根据{{user}}设定来生成具有趣味性的初始化卡组。初始卡组应该包含五张基础防御，五张基础攻击，1-3张不同的特殊卡。基础防御和基础攻击，可根据卡组体系，设计不同的效果，但是不宜过强，过复杂。尽量避免，没有特色的卡牌，只有增加防御，造成伤害这样单种效果。特殊卡则能体现出卡组体系的核心。
- 无论怎么样，初始化的卡牌数量不少于十张，卡牌使用`quantity`的数值来代表多张，基础卡牌一般有多张，强力复杂卡牌一般只有一张
- 一定避免初始卡牌小于十张（总`quantity`）的情况

### 道具遗物初始化
- 生成1-2个能够代表{{user}}特性的遗物，和初始道具
- 根据剧情设定来生成，大部分情况都要生成
- 遗物要能和卡组配合，或通用的增强，不能完全对游戏没有帮助
- 道具根据实际剧情生成，可用性随意

### 欲望效果初始化
- 根据{{user}}的性检验，来生成{{user}}的初始欲望效果
- 欲望效果，即为战斗中，让敌人达到性高潮后的效果。根据{{user}}的卡组，应该有不同的生成方案。
- 当{{user}}的卡组和欲望效果无关时，{{user}}的欲望效果应该没什么大作用，因为基本不会触发，所以生成一些基础效果即可
- 当{{user}}的卡组是以欲望效果为主，或有很多增加欲望效果的卡牌时，{{user}}的欲望效果就应该有很强大的性能，让{{user}}能在敌人欲望效果触发1-3次后，造成的伤害或其他效果足以让{{user}}胜利，或触发叙事效果来结束战斗。
- 不能出现玩家只能靠欲望效果战斗，但是欲望效果完全无法结束战斗，或需要超长的时间才能结束的情况。
- 本轮的欲望效果是指{{user}}让敌方达到性高潮后，可以获得的效果，一般为造成伤害，削弱敌人或对自己的增益

### 阵营和倾向初始化
-  生成{{user}}的九宫格道德阵营倾向
-  根据需求，生成和{{user}}有关的势力与关系，如果没有具体的势力，则不需要生成

### 状态效果定义初始化
- 如果上述生成的卡牌，道具，遗物，欲望效果，涉及到具体的状态效果（buff），则需要在此处，注册具体的状态效果。必须要注册，否则对应的道具无法正常使用。

### NPC关系初始化
- 如果剧情一开始，就出现了和{{user}}有关的重要NPC角色，则需要初始化该NPC的相关信息。



# 首次变量更新规则
# 此规则仅在首次生成变量时作为指导，用以确保初始状态的逻辑性和一致性。
# 所有数值和设定均应基于开幕剧情和{{user}}的角色背景进行合理推导。

rule:
  description:
    - 严格按照以下规则和格式进行输出，并确定每一个变量是否需要更新，不要遗漏。
    - You should output the update analysis in the end of the next response, following the variables list defined in <status_current_variables> section which will be provided by the previous turn.
    - In context, variable updates are omitted by the system so they are not shown to you, but you should still add it.
    - There are 4 commands can be used to adjust the data: `_.set`, `_.assign`, `_.remove` and `_.add`.
    - to set a certain value, use `_.set`, it supports 2 or 3 input args.
    - to insert something into an array or object, use `_.assign`, it supports 2 or 3 input args.
    - to delete something from an object/array, use `_.remove`, it supports 1 or 2 input args.
    - If you need to assign or remove multiple values, use `_.assign` or `_.remove` multiple times, not in a single command.
    - to add a delta to a number, use `_.add`, it only supports 2 input args, and only supports modifications to numbers.
    - It is allowed to use math expressions for number inputs.
  analysis:
    - You must rethink what variables are defined in the previous <status_current_variables> property, and analyze how to update each of them accordingly.
    - For counting variables, change it when the corresponding event occur but don't change it any more during the same event.
    - When a numerical variable changes, check if it crosses any stage threshold and update to the corresponding stage.
    - If dest element is in an array with description, **PRECISELY** locate the element by adding "[0]" suffix. DO NOT change the description.
  format: |-
    <UpdateVariable>
        <Analysis>$(IN ENGLISH$)
            - This is the initial setup. All variables must be populated based on the user's character and the starting scenario.
            - `status.time`: Set based on the opening scene's time of day. Use `_.set`.
            - `status.location_weather`: Describe the initial location and weather. Use `_.set`.
            - `status.profession`: Define the character's role and core abilities. Use `_.set`.
            - `status.permanent_status`: Assign any long-term traits from the character's backstory.Use `_.assign` to register.
            - `status.temporary_status`: Add any immediate states from the opening scene (e.g., 'Confused', 'Injured').Use `_.assign` to register.
            - `status.clothing`: Detail the character's full attire.`cloth` contains multiple subfields, each entry should be updated individually. Use `_.set`.
            - `status.inventory`: List starting non-combat items.Use `_.assign` to register.
            - `battle.core`: Set `hp`, `max_hp`, `lust`, `max_lust` based on character concept.  Use `_.set`.
            - `battle.cards`: Create a starting deck with an established theme reflecting the character's profession and background.Use `_.assign` to register.
            - `battle.artifacts`: Grant starting artifacts that complement the deck's theme or character concept.Use `_.assign` to register.
            - `battle.items`: Grant starting consumable items relevant to the scenario.Use `_.assign` to register.
            - `battle.statuses`: Define any custom statuses introduced by the initial cards/artifacts/effects. This field must be populated if other effects rely on custom statuses.Use `_.assign` to register.
            - `battle.level` & `exp`: The level and experience default to Level 1 and 0 respectively. The specific level and exp can be changed during initialization based on the plot/story... Use `_.add`or `_.set`.
            - `battle.player_lust_effect`: Define the effect triggered when the player climaxes an enemy, synergistic with their abilities.Use `_.set`.
            - `factions.player_alignment`: Set based on character's described morality.Use `_.set`.
            - `factions.relations`: Initialize relationships with factions present in the opening scene, if any.Use `_.assign` to register.
            - `npcs`: If any key NPCs are present at the start, create their profiles.Use `_.assign` to register.
        </Analysis>
        _.set('${path}', ${old}?, ${new});//${reason}
        _.assign('${path}', ${key_or_index}?, ${value});//${reason}
        _.remove('${path}', ${key_or_index_or_value}?);//${reason}
        _.add('${path}', ${delta});//${reason}
    </UpdateVariable>
  example: |-
    <UpdateVariable>
        <Analysis>
            Initialization based on a starting scenario where the character is a "Shadowmancer" waking up in a crypt.
            - `status.time`: '深夜, 02:15'
            - `status.location_weather`: '地点 - 环境描写'
            - `battle.core.hp`: 80 (Slightly frail build)
            - `battle.core.max_hp`: 80
            - `battle.cards`: Add 'Shadow Strike' (Attack), 'Umbral Veil' (Defense), 'Soul Siphon' (Skill).
            - `battle.artifacts`: Add 'Tome of Whispers' artifact.
            - `factions.player_alignment`: 'True Neutral'
            ... and so on for all relevant fields.
        </Analysis>
        _.set('status.time', '', '深夜, 02:15');//Initial scene time.
        _.set('status.location_weather', '', '地点 - 阴冷潮湿');//Initial scene location.
        _.set('battle.core.hp', 100, 80);//Character is frail.
        _.set('battle.core.max_hp', 100, 80);//Character is frail.
        _.assign('battle.cards', { 卡牌效果字段 });//Initial attack card.
        ...
    </UpdateVariable>
