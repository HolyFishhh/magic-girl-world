<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é—ç‰©æ˜¾ç¤ºåŠŸèƒ½æµ‹è¯•</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #1a1a1a;
        color: white;
        padding: 20px;
      }

      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: #2a2a2a;
        padding: 20px;
        border-radius: 10px;
      }

      .relic-section {
        margin-bottom: 20px;
      }

      .relic-label {
        font-size: 1.1em;
        color: #90ee90;
        margin-bottom: 10px;
        font-weight: bold;
      }

      .relic-grid {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        min-height: 30px;
        align-items: center;
      }

      .relic-grid .no-relics {
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
        font-size: 0.8em;
        text-align: center;
        padding: 10px;
      }

      .relic-grid .relic-item {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 2px;
        background: transparent;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        min-width: 32px;
        min-height: 32px;
      }

      .relic-grid .relic-item .relic-emoji {
        font-size: 0.9em;
        transition: all 0.3s ease;
        z-index: 2;
        flex-shrink: 0;
      }

      .relic-grid .relic-item .relic-details {
        opacity: 0;
        width: 0;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        white-space: nowrap;
      }

      .relic-grid .relic-item .relic-details .relic-name {
        font-size: 0.7em;
        font-weight: bold;
        margin-bottom: 1px;
        color: #ffd700;
      }

      .relic-grid .relic-item .relic-details .relic-description {
        font-size: 0.6em;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.2;
        margin-bottom: 1px;
      }

      .relic-grid .relic-item .relic-details .relic-effects {
        margin-top: 1px;
      }

      .relic-grid .relic-item .relic-details .relic-effects .effect-tag {
        font-size: 0.5em;
        padding: 1px 2px;
        margin-right: 1px;
        background: rgba(100, 149, 237, 0.3);
        border: 1px solid rgba(100, 149, 237, 0.5);
        border-radius: 4px;
        color: #87ceeb;
      }

      /* æ‚¬åœçŠ¶æ€ï¼šä¸´æ—¶å±•å¼€ */
      .relic-grid .relic-item:hover:not(.expanded) {
        padding: 2px 8px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 215, 0, 0.3);
        border-radius: 16px;
        transform: scale(1.02);
        z-index: 10;
      }

      .relic-grid .relic-item:hover:not(.expanded) .relic-details {
        opacity: 1;
        width: auto;
        margin-left: 4px;
        max-width: 140px;
      }

      /* ç‚¹å‡»æ¿€æ´»çŠ¶æ€ï¼šæŒç»­å±•å¼€ */
      .relic-grid .relic-item.expanded {
        padding: 2px 8px;
        background: rgba(255, 215, 0, 0.15);
        border: 1px solid rgba(255, 215, 0, 0.6);
        border-radius: 16px;
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        z-index: 15;
      }

      .relic-grid .relic-item.expanded .relic-details {
        opacity: 1;
        width: auto;
        margin-left: 4px;
        max-width: 160px;
      }

      .relic-tooltip {
        position: absolute;
        background: linear-gradient(135deg, #2c3e50, #34495e);
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        border: 2px solid #3498db;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
        z-index: 5000;
        max-width: 250px;
        font-size: 0.9em;
      }

      .relic-tooltip .relic-tooltip-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }

      .relic-tooltip .relic-tooltip-header .relic-tooltip-emoji {
        font-size: 1.2em;
      }

      .relic-tooltip .relic-tooltip-header .relic-tooltip-name {
        font-weight: bold;
        color: #3498db;
      }

      .relic-tooltip .relic-tooltip-description {
        margin-bottom: 6px;
        line-height: 1.4;
        color: #ecf0f1;
      }

      .relic-tooltip .relic-tooltip-effect {
        font-size: 0.8em;
        color: #bdc3c7;
        font-style: italic;
      }

      .test-controls {
        margin-bottom: 20px;
      }

      .test-controls button {
        background: #3498db;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
      }

      .test-controls button:hover {
        background: #2980b9;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>é—ç‰©æ˜¾ç¤ºåŠŸèƒ½æµ‹è¯•</h1>

      <div class="test-controls">
        <button onclick="loadTestRelics()">åŠ è½½æµ‹è¯•é—ç‰©</button>
        <button onclick="clearRelics()">æ¸…ç©ºé—ç‰©</button>
        <button onclick="addSingleRelic()">æ·»åŠ å•ä¸ªé—ç‰©</button>
      </div>

      <div class="relic-section">
        <div class="relic-label">ğŸº é—ç‰©:</div>
        <div class="relic-grid">
          <!-- é—ç‰©åœ¨æ­¤æ˜¾ç¤º -->
        </div>
      </div>

      <div style="margin-top: 30px">
        <h3>åŠŸèƒ½è¯´æ˜ï¼š</h3>
        <ul>
          <li>é»˜è®¤çŠ¶æ€ï¼šåªæ˜¾ç¤ºé—ç‰©çš„emoji</li>
          <li>æ‚¬åœçŠ¶æ€ï¼šä¸´æ—¶æ˜¾ç¤ºé—ç‰©çš„è¯¦ç»†ä¿¡æ¯</li>
          <li>ç‚¹å‡»çŠ¶æ€ï¼šæŒç»­æ˜¾ç¤ºé—ç‰©çš„è¯¦ç»†ä¿¡æ¯ï¼Œå†æ¬¡ç‚¹å‡»æ”¶èµ·</li>
          <li>åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªé—ç‰©å¤„äºå±•å¼€çŠ¶æ€</li>
        </ul>
      </div>
    </div>

    <script>
      // æµ‹è¯•æ•°æ®
      const testRelics = [
        {
          id: 'starter_charm',
          name: 'åˆå­¦è€…æŠ¤ç¬¦',
          emoji: 'ğŸ”®',
          description: 'æˆ˜æ–—å¼€å§‹æ—¶è·å¾—2ç‚¹æ ¼æŒ¡',
          effect: 'on_battle_start:block:2',
          rarity: 'Common',
        },
        {
          id: 'power_ring',
          name: 'åŠ›é‡ä¹‹æˆ’',
          emoji: 'ğŸ’',
          description: 'æ¯å›åˆå¼€å§‹æ—¶è·å¾—1ç‚¹åŠ›é‡',
          effect: 'on_turn_start:strength:1',
          rarity: 'Uncommon',
        },
        {
          id: 'healing_amulet',
          name: 'æ²»ç–—æŠ¤ç¬¦',
          emoji: 'âœ¨',
          description: 'å—åˆ°ä¼¤å®³æ—¶æœ‰25%å‡ ç‡æ¢å¤3ç‚¹ç”Ÿå‘½å€¼',
          effect: 'on_take_damage:heal:3:chance:25',
          rarity: 'Rare',
        },
        {
          id: 'energy_crystal',
          name: 'èƒ½é‡æ°´æ™¶',
          emoji: 'ğŸ’',
          description: 'æ¯å›åˆé¢å¤–è·å¾—1ç‚¹èƒ½é‡',
          effect: 'on_turn_start:energy:1',
          rarity: 'Epic',
        },
      ];

      function createEffectTag(effect) {
        // ç®€å•çš„æ•ˆæœæ ‡ç­¾ç”Ÿæˆ
        if (effect.includes('block')) return '<span class="effect-tag">æ ¼æŒ¡</span>';
        if (effect.includes('strength')) return '<span class="effect-tag">åŠ›é‡</span>';
        if (effect.includes('heal')) return '<span class="effect-tag">æ²»ç–—</span>';
        if (effect.includes('energy')) return '<span class="effect-tag">èƒ½é‡</span>';
        return '<span class="effect-tag">æ•ˆæœ</span>';
      }

      function updateRelicsDisplay(relics) {
        const relicsContainer = $('.relic-grid');

        if (!relics || relics.length === 0) {
          relicsContainer.html('<div class="no-relics">æš‚æ— é—ç‰©</div>');
          return;
        }

        const relicsHTML = relics
          .map(relic => {
            const effectTagsHTML = createEffectTag(relic.effect || '');

            return `
                <div class="relic-item"
                     data-relic-id="${relic.id}"
                     data-relic-name="${relic.name || 'æœªçŸ¥é—ç‰©'}"
                     data-relic-description="${relic.description || 'æ— æè¿°'}"
                     data-relic-effect="${relic.effect || 'æ— æ•ˆæœ'}">
                  <div class="relic-emoji">${relic.emoji || 'ğŸ“¿'}</div>
                  <div class="relic-details">
                    <div class="relic-name">${relic.name || 'æœªçŸ¥é—ç‰©'}</div>
                    <div class="relic-description">${relic.description || 'æ— æè¿°'}</div>
                    <div class="relic-effects">${effectTagsHTML}</div>
                  </div>
                </div>
                `;
          })
          .join('');

        relicsContainer.html(relicsHTML);

        // ç»‘å®šç‚¹å‡»å’Œæ‚¬åœäº‹ä»¶
        relicsContainer
          .find('.relic-item')
          .on('click', function () {
            const $this = $(this);
            const isExpanded = $this.hasClass('expanded');

            // å…ˆæ”¶ç¼©æ‰€æœ‰å…¶ä»–é—ç‰©
            relicsContainer.find('.relic-item').removeClass('expanded');

            // å¦‚æœå½“å‰é—ç‰©ä¹‹å‰æ²¡æœ‰å±•å¼€ï¼Œåˆ™å±•å¼€å®ƒ
            if (!isExpanded) {
              $this.addClass('expanded');
            }
          })
          .on('mouseenter', function () {
            // å¦‚æœå½“å‰é—ç‰©æ²¡æœ‰å±•å¼€ï¼Œæ˜¾ç¤ºæ‚¬åœæç¤º
            const $this = $(this);
            if (!$this.hasClass('expanded')) {
              const relicId = $(this).data('relic-id');
              const relic = relics.find(r => r.id === relicId);
              if (relic) {
                showRelicTooltip($(this), relic);
              }
            }
          })
          .on('mouseleave', function () {
            // ç§»é™¤æ‚¬åœæç¤º
            $('.relic-tooltip').remove();
          });

        console.log(`ğŸ”® æ›´æ–°é—ç‰©æ˜¾ç¤º: ${relics.length} ä¸ªé—ç‰©`, relics);
      }

      function showRelicTooltip(element, relic) {
        $('.relic-tooltip').remove();

        const tooltip = $(`
              <div class="relic-tooltip">
                <div class="relic-tooltip-header">
                  <span class="relic-tooltip-emoji">${relic.emoji || 'ğŸ“¿'}</span>
                  <span class="relic-tooltip-name">${relic.name}</span>
                </div>
                <div class="relic-tooltip-description">${relic.description || 'æ— æè¿°'}</div>
                <div class="relic-tooltip-effect">æ•ˆæœ: ${relic.effect || 'æ— æ•ˆæœ'}</div>
              </div>
            `);

        $('body').append(tooltip);

        // å®šä½æç¤ºæ¡†
        const elementOffset = element.offset();
        if (elementOffset) {
          const tooltipHeight = tooltip.outerHeight() || 0;
          const tooltipWidth = tooltip.outerWidth() || 0;
          const elementWidth = element.outerWidth() || 0;

          tooltip.css({
            top: elementOffset.top - tooltipHeight - 10,
            left: elementOffset.left + elementWidth / 2 - tooltipWidth / 2,
          });
        }
      }

      function loadTestRelics() {
        updateRelicsDisplay(testRelics);
      }

      function clearRelics() {
        updateRelicsDisplay([]);
      }

      function addSingleRelic() {
        const singleRelic = [
          {
            id: 'test_single',
            name: 'æµ‹è¯•é—ç‰©',
            emoji: 'ğŸ¯',
            description: 'è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•çš„é—ç‰©',
            effect: 'on_battle_start:test:1',
            rarity: 'Common',
          },
        ];
        updateRelicsDisplay(singleRelic);
      }

      // åˆå§‹åŒ–
      $(document).ready(function () {
        console.log('é—ç‰©æ˜¾ç¤ºæµ‹è¯•é¡µé¢å·²åŠ è½½');
        clearRelics();
      });
    </script>
  </body>
</html>
